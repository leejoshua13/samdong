<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>No.1 - 창지족-1 지도</title>
  <!-- 네이버 지도 API -->
  <script src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpKeyId=wer9y0rp81"></script>
  <style>
    .container { max-width:700px; margin:0 auto; padding:0 16px; box-sizing:border-box; }
    body { font-family:Arial, sans-serif; margin:20px 0; padding-bottom:100px; }
    h2 { margin-top:0; }
    #map { width:100%; height:600px; margin-bottom:20px; border-radius:8px; overflow:hidden; }
    input, button, textarea { width:100%; padding:8px; margin:8px 0; box-sizing:border-box; font-size:1rem; }
    textarea { resize:vertical; height:100px; }
    .label-marker { font-size:16px; font-weight:bold; color:red; background:none; border:none; text-align:center; }
    .bottom-nav { position:fixed; bottom:0; left:0; width:100%; background:#f9f9f9; border-top:1px solid #ddd; display:flex; justify-content:space-around; padding:10px 0; }
    .bottom-nav button { width:45%; padding:10px; font-size:16px; }
  </style>
</head>
<body>

  <div class="container">
    <h2>No.1 – 창지족-1</h2>
    <div id="map"></div>

    <label>시작 날짜:
      <input type="date" id="start-date">
    </label>

    <label>종료 날짜:
      <input type="date" id="end-date">
    </label>

    <label>담당자:
      <input type="text" id="person-name" placeholder="이름 입력">
    </label>

    <label>메모:
      <textarea id="memo" placeholder="메모를 입력하세요"></textarea>
    </label>

    <button id="save-btn">저장</button>
  </div>

  <div class="bottom-nav">
    <button onclick="location.href='index.html'">홈</button>
    <button onclick="location.href='index.html#records'">기록 확인</button>
  </div>

  <!-- Firebase & App Logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-app.js";
    import { getDatabase, ref, push } from "https://www.gstatic.com/firebasejs/11.6.0/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDk9fpF-lsGYeuRNcvfaB0cpdANK-mDPSQ",
      authDomain: "sandong-9579a.firebaseapp.com",
      databaseURL: "https://sandong-9579a-default-rtdb.firebaseio.com",
      projectId: "sandong-9579a",
      storageBucket: "sandong-9579a.appspot.com",
      messagingSenderId: "130428062710",
      appId: "1:130428062710:web:002f9d0899f5b7c5cad5d7"
    };

    const app = initializeApp(firebaseConfig);
    const db  = getDatabase(app);

    // 지도 초기화
    const subs = {
      '1-1': [[128.0009778761463,34.83691669235313], /* …이하 좌표 생략… */ [128.0009778761463,34.83690050182301]],
      '1-2': [[128.00032156773085,34.83604817076878], /* … */ [128.00031768557807,34.83604498433664]],
      '1-3': [[127.9982574644215,34.836879929354765], /* … */ [127.99825450246698,34.83688186165479]]
    };
    const map = new naver.maps.Map('map', { zoom: 16 });
    const bounds = new naver.maps.LatLngBounds();

    Object.entries(subs).forEach(([key, coords]) => {
      const path = coords.map(([lng, lat]) => new naver.maps.LatLng(lat, lng));
      new naver.maps.Polyline({ map, path, strokeColor: '#f00', strokeWeight: 2 });
      path.forEach(p => bounds.extend(p));
      const sb = new naver.maps.LatLngBounds(path[0], path[0]);
      path.forEach(p => sb.extend(p));
      new naver.maps.Marker({
        position: sb.getCenter(),
        map,
        icon: {
          content: `<div class="label-marker">${key.split('-')[1]}</div>`,
          anchor: new naver.maps.Point(0, 0)
        }
      });
    });
    map.fitBounds(bounds);
    if (map.getZoom() > 17) map.setZoom(17);

    // 저장 버튼 이벤트
    document.getElementById('save-btn').addEventListener('click', () => {
      const record = {
        zone: 'No.1 – 창지족-1',
        startDate: document.getElementById('start-date').value,
        endDate:   document.getElementById('end-date').value,
        personName: document.getElementById('person-name').value,
        memo:      document.getElementById('memo').value,
        savedAt:   new Date().toISOString()
      };
      push(ref(db, 'zoneRecords'), record);
      alert('기록이 저장되었습니다!');
      location.href = 'index.html#records';
    });
  </script>
</body>
</html>
